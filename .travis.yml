#
# Config
arch: amd64
os: linux
dist: xenial
sudo: false

env:
  global:
    - SONAR_TOKEN=${travis2sonar}
    - DL_DIR=${HOME}/temp
    - GLOBAL_POM_V=0.2.1
    - GLOBAL_POM_DIR=${DL_DIR}/global-pom/${GLOBAL_POM_V}
    - GLOBAL_POM_FILE=${GLOBAL_POM_DIR}/pom.xml
    - GLOBAL_POM_INSTALL="-DgroupId=com.glowa-net.maven.parent -DartifactId=global-pom -Dversion=${GLOBAL_POM_V} -Dpackaging=pom"
cache:
  directories:
    - ${HOME}/.m2

language: java
jdk: openjdk11

#
# Steps
before_install:
  - mkdir -p -v ${GLOBAL_POM_DIR}
  - wget -v -x https://github.com/ollily/global-pom/releases/download/${GLOBAL_POM_V}/pom.xml -O ${GLOBAL_POM_FILE}

install:
  - mvn -B -V install:install-file -Dfile=${GLOBAL_POM_FILE} ${GLOBAL_POM_INSTALL}
  - mvn -B -V dependency:resolve dependency:resolve-plugins
  
before_script: skip

script:
  - mvn -B -V -DskipTests=true -DskipITs=true -Dmaven.javadoc.skip=true clean install

after_script: skip
  - mvn -B -DskipTests=true -DskipITs=true -Dmaven.test.failure.ignore=true org.sonarsource.scanner.maven:sonar-maven-plugin:sonar

#
# Finally

after_success: skip

after_failure: skip
